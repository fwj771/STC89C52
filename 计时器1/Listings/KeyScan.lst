C51 COMPILER V9.54   KEYSCAN                                                               10/17/2025 14:03:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEYSCAN
OBJECT MODULE PLACED IN .\Objects\KeyScan.obj
COMPILER INVOKED BY: D:\Keil\Keil5 C51\C51\BIN\C51.EXE KeyScan.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\Ke
                    -yScan.lst) TABS(2) OBJECT(.\Objects\KeyScan.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "DelayMs.h"
   3          /**
   4            * @brief  KeyScan模板
   5            * @param  无
   6            * @retval 无
   7            */
   8          //sbit KEY_ = P ^ ;
   9          
  10          //void KeyScan(void)
  11          //{
  12          //  static bit keyLock = 0;
  13          
  14          //  if(KEY_ == 0 && !keyLock)
  15          //  {
  16          //    DelayMs(20);
  17          //    if(KEY_ == 0)
  18          //    {
  19          //      keyLock = 1;
  20          //      //功能
  21          //    }
  22          //  }
  23          //  else if(KEY_ == 1)
  24          //  {
  25          //    keyLock = 0;
  26          //  }
  27          //}
  28          
  29          // 按键
  30          sbit KEY_STARTSTOP = P3^0;
  31          sbit KEY_SET = P3^1;
  32          sbit KEY_RESET = P3^2;
  33          sbit KEY_ALARM = P3^3;
  34          
  35          // 外部变量声明
  36          extern unsigned char hour;
  37          extern unsigned char minute;
  38          extern unsigned char second;
  39          extern bit isRunning;
  40          extern bit settingMode;
  41          extern unsigned char settingPos;
  42          extern volatile bit updateDisplay;
  43          extern volatile bit alarmState;
  44          
  45          void KeyScan(void)
  46          {
  47   1        static bit keyLockStart = 0;
  48   1        static bit keyLockSet = 0;
  49   1        static bit keyLockReset = 0;
  50   1        static bit keyLockAlarm = 0;
  51   1      
  52   1        // -------- 设置键 SET --------
  53   1        if(KEY_SET == 0 && !keyLockSet)
  54   1        {
C51 COMPILER V9.54   KEYSCAN                                                               10/17/2025 14:03:08 PAGE 2   

  55   2          DelayMs(20);
  56   2          if(KEY_SET == 0)
  57   2          {
  58   3            keyLockSet = 1;
  59   3      
  60   3            // 如果不在设置模式 → 进入设置模式
  61   3            if(!settingMode)
  62   3            {
  63   4              settingMode = 1;
  64   4              isRunning = 0;
  65   4              settingPos = 0;
  66   4              updateDisplay = 1;
  67   4            }
  68   3            // 如果已经在设置模式 → 退出设置模式
  69   3            else
  70   3            {
  71   4              settingMode = 0;
  72   4              updateDisplay = 1;
  73   4            }
  74   3          }
  75   2        }
  76   1        else if(KEY_SET == 1)
  77   1        {
  78   2          keyLockSet = 0;
  79   2        }
  80   1      
  81   1        // -------- 启停键 START/STOP --------
  82   1        if(KEY_STARTSTOP == 0 && !keyLockStart)
  83   1        {
  84   2          DelayMs(20);
  85   2          if(KEY_STARTSTOP == 0)
  86   2          {
  87   3            keyLockStart = 1;
  88   3            if(!settingMode) // 仅在非设置模式下有效
  89   3            {
  90   4              isRunning = !isRunning;
  91   4              updateDisplay = 1;
  92   4            }
  93   3          }
  94   2        }
  95   1        else if(KEY_STARTSTOP == 1)
  96   1        {
  97   2          keyLockStart = 0;
  98   2        }
  99   1        
 100   1        // -------- 复位键 RESET --------
 101   1        if(KEY_RESET == 0 && !keyLockReset)
 102   1        {
 103   2          DelayMs(20);
 104   2          if(KEY_RESET == 0)
 105   2          {
 106   3            keyLockReset = 1;
 107   3            if(!isRunning)
 108   3            {
 109   4              hour = minute = second = 0;
 110   4              settingPos = 0;
 111   4              updateDisplay = 1;
 112   4            }
 113   3          }
 114   2        }
 115   1        else if(KEY_RESET == 1)
 116   1        {
C51 COMPILER V9.54   KEYSCAN                                                               10/17/2025 14:03:08 PAGE 3   

 117   2          keyLockReset = 0;
 118   2        }
 119   1        // -------- 闹钟键 ALARM --------
 120   1        if(KEY_ALARM == 0 && !keyLockAlarm)
 121   1        {
 122   2          DelayMs(20);
 123   2          if(KEY_ALARM == 0)
 124   2          {
 125   3            alarmState = 0;
 126   3          }
 127   2        }
 128   1        else if(KEY_ALARM == 1)
 129   1        {
 130   2          keyLockAlarm = 0;
 131   2        }
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    139    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
