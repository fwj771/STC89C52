C51 COMPILER V9.54   BUZZER                                                                11/07/2025 20:54:29 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BUZZER
OBJECT MODULE PLACED IN .\Objects\Buzzer.obj
COMPILER INVOKED BY: D:\Keil\Keil5 C51\C51\BIN\C51.EXE Buzzer.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\Buz
                    -zer.lst) TABS(2) OBJECT(.\Objects\Buzzer.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "Delay.h"
   3          #include "KeyScan.h"
   4          
   5          /*==================================*
   6           *           蜂鸣器配置             *
   7           *==================================*/
   8          sbit BUZZER = P2^5;    // 蜂鸣器引脚（翻转输出产生声音）
   9          
  10          
  11          /*==================================*
  12           *        音符定时器重装载表        *
  13           *   （已校准，可直接使用，无需改） *
  14           *==================================*/
  15          code unsigned int NoteReload[] = {
  16              63628,63731,63835,63928,64021,64103,64185,64260,64331,64400,64463,64528,64580,64633,
  17              64684,64732,64777,64820,64860,64898,64934,64968,65000,65030,65058,65085,65110,65134,
  18              65157,65178,65198,65217,65235,65252,65268,65283
  19          };
  20          
  21          
  22          /*==================================*
  23           *             音符定义              *
  24           *==================================*/
  25          #define NOTE_C5   13    // 523 Hz
  26          #define NOTE_G5   20    // 784 Hz
  27          #define NOTE_A5   22    // 880 Hz
  28          #define NOTE_REST  0    // 休止符（静音）
  29          
  30          
  31          /*==================================*
  32           *           乐谱结构体              *
  33           *==================================*/
  34          typedef struct
  35          {
  36              unsigned char Note;        // 音符值
  37              unsigned int  Duration;    // 持续时间（ms）
  38          } MusicNote;
  39          
  40          
  41          /*==================================*
  42           *            曲谱示例               *
  43           *==================================*/
  44          const MusicNote Song[] = {
  45              {NOTE_C5, 500}, {NOTE_C5, 500},
  46              {NOTE_G5, 500}, {NOTE_G5, 500},
  47              {NOTE_A5, 500}, {NOTE_A5, 500},
  48              {NOTE_G5, 1000}
  49          };
  50          
  51          unsigned char SongLength = sizeof(Song) / sizeof(MusicNote);
  52          unsigned int ReloadValue;
  53          
  54          
C51 COMPILER V9.54   BUZZER                                                                11/07/2025 20:54:29 PAGE 2   

  55          /**
  56            * @brief  蜂鸣器初始化（定时器1方式1）
  57            * @param  无
  58            * @retval 无
  59            */
  60          void Buzzer_Init(void)
  61          {
  62   1          TMOD &= 0x0F;     // 清 T1 控制位
  63   1          TMOD |= 0x10;     // T1 = 方式1
  64   1          ET1 = 1;          // 开 T1 中断
  65   1          EA  = 1;          // 开总中断
  66   1          TR1 = 0;          // 初始关闭
  67   1      }
  68          
  69          
  70          /**
  71            * @brief  设置当前音符
  72            * @param  Note: 音符索引
  73            */
  74          void Buzzer_SetNote(unsigned char Note)
  75          {
  76   1          if(Note == NOTE_REST)
  77   1          {
  78   2              TR1 = 0;
  79   2              BUZZER = 1;   // 静音
  80   2              return;
  81   2          }
  82   1      
  83   1          ReloadValue = NoteReload[Note - 1];
  84   1          TH1 = ReloadValue >> 8;
  85   1          TL1 = ReloadValue & 0xFF;
  86   1          TR1 = 1;         // 开始输出方波
  87   1      }
  88          
  89          
  90          /**
  91            * @brief  定时器1中断：不断翻转蜂鸣器输出
  92            */
  93          void Timer1_ISR(void) interrupt 3
  94          {
  95   1          TH1 = ReloadValue >> 8;
  96   1          TL1 = ReloadValue & 0xFF;
  97   1          BUZZER = ~BUZZER;
  98   1      }
  99          
 100          
 101          /**
 102            * @brief  播放单个音符
 103            * @param  Note: 音符
 104            * @param  Duration: 持续时间(ms)
 105            */
 106          void Buzzer_PlayNote(unsigned char Note, unsigned int Duration)
 107          {
 108   1          Buzzer_SetNote(Note);
 109   1          DelayMs(Duration);
 110   1      
 111   1          Buzzer_SetNote(NOTE_REST);
 112   1          DelayMs(50); // 音符间短暂停顿
 113   1      }
 114          
 115          
 116          /**
C51 COMPILER V9.54   BUZZER                                                                11/07/2025 20:54:29 PAGE 3   

 117            * @brief  播放整首乐曲
 118            * @param  无
 119            * @retval 无
 120            */
 121          void MusicPlay(void)
 122          {
 123   1          unsigned char i;
 124   1      
 125   1          for(i = 0; i < SongLength; i++)
 126   1          {
 127   2              Buzzer_PlayNote(Song[i].Note, Song[i].Duration);
 128   2          }
 129   1      
 130   1          Buzzer_SetNote(NOTE_REST);
 131   1          TR1 = 0;   // 停止输出
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    143    ----
   CONSTANT SIZE    =     72    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     24       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
